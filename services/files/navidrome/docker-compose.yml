services:
  navidrome:
    container_name: navidrome
    restart: unless-stopped
    image: deluan/navidrome:latest
    networks:
      - services
    environment:
      - ND_SCANSCHEDULE=1h
      - ND_LOGLEVEL=info
      - ND_SESSIONTIMEOUT=24h
      - ND_ENABLESHARING=true
      - ND_LASTFM_ENABLED=true
      - ND_LASTFM_APIKEY="${ND_LASTFM_APIKEY}"
      - ND_LASTFM_SECRET="${ND_LASTFM_SECRET}"
      - ND_PASSWORDENCRYPTIONKEY="${ND_PASSWORDENCRYPTIONKEY}"
      - ND_BACKUP_PATH=/backup
      - ND_BACKUP_SCHEDULE=*/5 0 * * *
      - ND_BACKUP_COUNT=7

    ports:
      - 8085:4533
    volumes:
      - "/var/lib/navidrome/backup:/backup"
      - "/var/lib/navidrome/data:/data"
      - "/var/lib/navidrome/collection:/music:ro"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.traefik.entrypoints=http"
      - "traefik.http.routers.navidrome.rule=Host(`${HOST}`)"
      - "traefik.http.services.navidrome.loadbalancer.server.port=4533"
      - "traefik.http.routers.navidrome.tls.certresolver=myresolver"
      - "homepage.group=Media streaming"
      - "homepage.name=Navidrome"
      - "homepage.icon=navidrome.svg"
      - "homepage.href=http://${HOST}"
      - "homepage.description=Music streaming"
networks:
  services:
    name: services
    external: true
