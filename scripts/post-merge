#!/bin/bash
# Redirect output to stderr.
exec 1>&2
# check if last commit contains something that has notes in the name
INCLUDED=playbooks
LOG_DIR="/var/log/ansible"; if [[ ! -d "$LOG_DIR" ]];then mkdir -p "$LOG_DIR"; fi

if git diff --name-only HEAD HEAD~1 | grep "$INCLUDED"; then
        # do something
        source env/bin/activate
        ansible-playbook -i inventory/prod.proxmox.yaml -e 'vars_file=prod' playbooks/common.yml >> "$LOG_DIR/common.log"
else
        echo "no $INCLUDED modified, nothing to do"
fi
